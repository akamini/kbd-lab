# Supabase 設定ガイド

## 概要

このプロジェクトでは、Supabase を使用してデータベース、認証、ストレージを管理しています。このドキュメントでは、Supabase の設定方法と、実装されている RLS ポリシーについて説明します。

## データベース構造

以下のテーブルが実装されています：

1. **profiles** - ユーザープロフィール情報（auth.users の拡張）
2. **categories** - プロダクトカテゴリ（キーボード、キーキャップなど）
3. **tags** - プロダクトに付けられるタグ
4. **products** - 登録されるプロダクト情報
5. **product_tags** - プロダクトとタグの中間テーブル
6. **favorites** - ユーザーのお気に入り情報

## RLS ポリシー

### データベースポリシー

以下のセキュリティポリシーが実装されています：

- **プロフィール**：誰でも閲覧可能、自分のプロフィールのみ編集可能
- **カテゴリ・タグ**：誰でも閲覧可能、管理者のみ作成・編集・削除可能
- **プロダクト**：誰でも閲覧可能、自分のプロダクトのみ作成可能、自分のプロダクトまたは管理者のみ編集・削除可能
- **お気に入り**：自分のお気に入りのみ閲覧・作成・削除可能（他人のいいねは操作・確認できない）

### ストレージポリシー

`product_images`バケットに以下のポリシーが設定されています：

- **画像の取得**：全てのユーザーに許可
- **画像の作成・更新・削除**：認証済みユーザーのみ、自分のフォルダ（UID 名のフォルダ）内のファイルのみ操作可能

## 使用方法

1. Supabase ダッシュボードの「SQL Editor」を開く
2. `migrations/01_initial_schema.md`の SQL を実行する
3. 必要に応じて初期データを投入する

## 注意事項

- RLS ポリシーは、フロントエンドからのアクセスを制限するものであり、バックエンドからのアクセスには適用されません。
- ストレージのフォルダ構造は `{user_id}/{file_name}` の形式で設計されています。
- 管理者権限は `profiles` テーブルの `is_admin` フラグで管理されています。
